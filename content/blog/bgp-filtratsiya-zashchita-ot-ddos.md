---
title: "BGP-фильтрация: как работает защита от DDoS по BGP-протоколу"
slug: bgp-filtratsiya-zashchita-ot-ddos
description: "Как работает BGP-based защита от DDoS: перенаправление трафика, скрабинг-центры, очистка и возврат чистого трафика. Сравнение с DNS-redirect подходом."
keywords:
  - bgp защита от ddos
  - bgp фильтрация
  - bgp anti-ddos
  - bgp scrubbing
  - очистка трафика bgp
date: 2025-07-14
---

# BGP-фильтрация: как работает защита от DDoS по BGP-протоколу

Ваш сервер принимает 1 Гбит/с трафика. Начинается DDoS-атака — 300 Гбит/с. Никакой файрвол на вашем сервере не поможет: 300 Гбит/с трафика физически не пройдут через 1-гигабитный порт. Канал забит ещё до того, как пакеты доберутся до вашего оборудования.

Для таких ситуаций существует BGP-фильтрация — метод защиты, при котором трафик перенаправляется и очищается ещё до того, как попадёт в вашу сеть. Это стандартный подход для защиты от volumetric DDoS-атак мощностью от десятков Гбит/с до нескольких Тбит/с.

## Что такое BGP

BGP (Border Gateway Protocol) — протокол маршрутизации между автономными системами (AS) в интернете. Проще говоря, BGP — это система навигации интернета. Он определяет, по какому маршруту пакеты данных пойдут от точки A до точки B.

Каждый крупный провайдер, дата-центр и CDN-сеть имеет свою автономную систему с уникальным номером (ASN). Автономные системы обмениваются маршрутной информацией через BGP: «у меня есть сеть 203.0.113.0/24, трафик для неё направляй ко мне».

Когда вы открываете сайт, ваш запрос проходит через несколько автономных систем. Каждая из них решает, куда направить пакет дальше, на основе BGP-таблицы маршрутов.

Ключевое свойство BGP: маршруты можно менять динамически. Если один путь перегружен или недоступен — трафик автоматически пойдёт по другому маршруту. Именно это свойство используется для DDoS-защиты.

## Зачем BGP в DDoS-защите

Проблема volumetric DDoS-атак — объём. Когда мощность атаки превышает ёмкость вашего канала, фильтрация на вашей стороне бесполезна. Трафик нужно перехватить и очистить до того, как он доберётся до вашей сети.

BGP позволяет это сделать элегантно: через анонс маршрутов весь трафик, предназначенный для вашей сети, перенаправляется в центр очистки провайдера anti-DDoS. Там вредоносные пакеты отбрасываются, а чистый трафик доставляется вам по защищённому каналу.

Ёмкость скрабинг-центров — от нескольких сотен Гбит/с до десятков Тбит/с. Это на порядки больше, чем пропускная способность типичного дата-центра.

## Как работает BGP-фильтрация: пошагово

### Шаг 1: Анонс маршрута

В нормальном режиме BGP-маршруты вашей сети указывают на вашу автономную систему. Трафик идёт напрямую к вашим серверам.

При активации защиты провайдер anti-DDoS анонсирует ваши IP-префиксы через свою AS. Весь интернет «узнаёт», что трафик для ваших адресов теперь нужно отправлять не к вам напрямую, а через сеть anti-DDoS провайдера.

**Технически:** Anti-DDoS провайдер отправляет BGP UPDATE сообщение с вашим префиксом и более специфичным маршрутом (более длинная маска) или с лучшими атрибутами пути. BGP-роутеры по всему интернету обновляют свои таблицы маршрутизации.

### Шаг 2: Перенаправление трафика

После обновления BGP-таблиц весь трафик для ваших IP-адресов поступает в сеть anti-DDoS провайдера — на ближайший скрабинг-центр.

Anti-DDoS провайдеры обычно имеют несколько скрабинг-центров по миру. Трафик попадает в ближайший по географии, что минимизирует задержку.

### Шаг 3: Очистка трафика

В скрабинг-центре трафик проходит через многоуровневую систему фильтрации:

1. **Volumetric фильтры** — отбрасывание явного мусора: пакеты с поддельными IP, аномальные размеры, невалидные заголовки.
2. **Протокольная фильтрация** — анализ TCP/UDP: SYN Cookies для TCP, валидация UDP-потоков, контроль фрагментации.
3. **Поведенческий анализ** — сравнение паттернов трафика с нормальным профилем. Аномальные источники блокируются.
4. **Сигнатурный анализ** — обнаружение известных паттернов атак.
5. **Rate limiting** — ограничение скорости для подозрительных источников.

На каждом этапе часть вредоносного трафика отбрасывается. К выходу из скрабинг-центра остаётся только чистый, легитимный трафик.

### Шаг 4: Возврат чистого трафика

Очищенный трафик доставляется к вашим серверам по защищённому каналу — обычно через GRE-туннель или прямое соединение (PNI — Private Network Interconnect).

GRE-туннель инкапсулирует ваш трафик внутрь другого IP-пакета. Это позволяет доставить трафик напрямую, минуя общую маршрутизацию и предотвращая петли.

Схема всего процесса:

```
Пользователь → Интернет → BGP-анонс → Скрабинг-центр → Очистка → GRE-туннель → Ваш сервер
```

Для пользователя всё прозрачно — он даже не знает, что трафик прошёл через скрабинг-центр. IP-адрес вашего сайта не меняется, DNS-записи не затрагиваются.

## Режимы работы

### Always-On (постоянная фильтрация)

Трафик всегда идёт через скрабинг-центр, независимо от наличия атаки. Защита мгновенная — атака начинает фильтроваться с первого пакета.

**Плюсы:** Нулевое время реакции, нет переключений, стабильная задержка.
**Минусы:** Постоянная дополнительная задержка (обычно 2–10 мс), стоимость трафика.

Подходит для: критичных сервисов, где даже минута простоя неприемлема — финансовые сервисы, e-commerce, игровые платформы.

### On-Demand (по запросу)

В нормальном режиме трафик идёт напрямую. При обнаружении атаки активируется BGP-анонс и трафик перенаправляется на очистку.

**Плюсы:** Нет дополнительной задержки в нормальном режиме, дешевле.
**Минусы:** Время переключения 1–5 минут (время конвергенции BGP). В эти минуты атака может быть ощутима.

Подходит для: сервисов, где несколько минут переключения допустимы.

### Hybrid

Комбинация: мониторинг трафика в реальном времени + автоматическое переключение на always-on при обнаружении аномалий. Обычно время детектирования + переключения — 30–90 секунд.

## Преимущества BGP-фильтрации

### Масштабируемость

Ёмкость скрабинг-центров измеряется в Тбит/с. Это единственный метод, способный справиться с атаками мощностью 500 Гбит/с и выше. Ваша инфраструктура не меняется — масштабируется только фильтрация.

### Прозрачность для пользователей

IP-адреса не меняются, DNS-записи остаются прежними. Пользователь не видит разницы — сайт работает как обычно. Нет необходимости менять A-записи или настройки приложения.

### Защита всей сети

BGP-фильтрация защищает не отдельный сайт, а весь IP-диапазон. Под защитой оказываются все сервисы: веб-серверы, почта, DNS, API, VPN — всё, что живёт в вашей сети.

### Работа на уровне провайдера

Фильтрация происходит до вашего оборудования. Даже если атака мощнее вашего канала в 100 раз — ваши серверы не пострадают, потому что вредоносный трафик до них не дойдёт.

### Совместимость

BGP — стандартный протокол. BGP-фильтрация работает с любым оборудованием и любым провайдером. Не нужно менять инфраструктуру или устанавливать специальное ПО.

## BGP vs DNS-redirect: сравнение подходов

DNS-redirect — альтернативный подход к DDoS-защите. Вместо перенаправления по BGP, трафик направляется через изменение DNS-записей: A-запись указывает не на ваш IP, а на IP anti-DDoS провайдера.

| Параметр | BGP-фильтрация | DNS-redirect |
|---|---|---|
| Что защищает | Весь IP-диапазон (все протоколы) | Конкретные домены (HTTP/HTTPS) |
| Скрытие реального IP | Нет — IP не меняется | Да — реальный IP скрыт за proxy |
| Время переключения | 1–5 мин (BGP-конвергенция) | 5–60 мин (TTL DNS-записей) |
| Always-On | Да | Да |
| Защита не-HTTP трафика | Да (TCP, UDP, любой протокол) | Нет — только HTTP/HTTPS |
| Требует изменения DNS | Нет | Да |
| Требует собственную AS | Обычно да (или используется AS провайдера) | Нет |
| Защита от атак на IP напрямую | Да | Нет — если атакующий знает реальный IP |
| Сложность настройки | Средняя — нужна координация с провайдером | Низкая — смена A-записи |

**Когда выбрать BGP:**
- У вас собственная AS и IP-пространство
- Нужна защита всех сервисов, не только веб
- Критична атака напрямую на IP (без DNS)
- Вы провайдер, хостинг или дата-центр

**Когда выбрать DNS-redirect:**
- У вас один-два веб-сайта
- Нет собственной AS
- Достаточно защиты только HTTP/HTTPS-трафика
- Нужно быстро подключиться без изменения инфраструктуры

Оптимальный вариант — комбинация обоих подходов. BGP-фильтрация для сетевого уровня + reverse proxy с [WAF и CDN](/cdn) для прикладного уровня.

## Кому подходит BGP-фильтрация

### Идеально подходит

- **Хостинг-провайдеры и дата-центры** — защита всей инфраструктуры и клиентов
- **Интернет-провайдеры (ISP)** — защита абонентской сети
- **Компании с собственной AS** — крупный бизнес, финтех, telecom
- **Игровые компании** — защита game-серверов (UDP-трафик), где DNS-redirect не работает
- **Финансовые организации** — требования к минимальному downtime

### Подходит с оговорками

- **Средний бизнес без собственной AS** — можно использовать AS провайдера anti-DDoS, но это усложняет конфигурацию
- **SaaS-компании** — если инфраструктура в облаке, облачный провайдер может предоставить BGP-защиту

### Лучше выбрать DNS-redirect

- **Малый бизнес с одним сайтом** — проще и дешевле
- **Сайты на shared-хостинге** — нет доступа к сетевым настройкам

## Что нужно для подключения

1. **Собственная AS и IP-пространство** (или готовность использовать AS провайдера)
2. **BGP-сессия с anti-DDoS провайдером** — настраивается совместно
3. **GRE-туннель или прямое соединение** — для возврата очищенного трафика
4. **Letter of Authorization (LOA)** — документ, разрешающий провайдеру анонсировать ваши префиксы

Процесс подключения занимает от нескольких часов до нескольких дней, в зависимости от сложности вашей сетевой конфигурации.

## Подключите защиту за 24 часа — бесплатно

BGP-фильтрация — самый надёжный метод защиты от volumetric DDoS-атак. Если ваш бизнес зависит от непрерывной работы сетевой инфраструктуры, это не вопрос выбора, а необходимость.

AntiDDoS.su предоставляет [BGP-based защиту от DDoS](/anti-ddos) с сетью скрабинг-центров и автоматическим обнаружением атак. Фильтрация начинается с первого пакета атаки, подключение — за 24 часа.

Для веб-проектов доступна комбинированная защита: BGP-фильтрация + [CDN с WAF](/cdn) для максимального покрытия на всех уровнях.

Протестируйте бесплатно — оставьте заявку, и мы подберём оптимальную схему защиты для вашей инфраструктуры.
